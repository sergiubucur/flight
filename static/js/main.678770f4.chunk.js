(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{18:function(t,e,i){},19:function(t,e,i){"use strict";i.r(e);var s=i(1),n=i(2),o=i(0),r=i(3),a=i.n(r),h=i(4),l=i(5),c=function(){function t(){Object(s.a)(this,t),this.assets={heightmap:{type:"texture",path:"assets/textures/heightmap.png"},spaceship:{type:"mesh",path:"assets/meshes/spaceship.obj",materialPath:"assets/meshes/spaceship.mtl"}},this.textures={},this.meshes={},this.assetsLoaded=0,this.assetCount=0,this.resolve=null}return Object(n.a)(t,[{key:"init",value:function(){var t=this;return new Promise(function(e){t.resolve=e,t.assetCount=Object.keys(t.assets).length,Object.keys(t.assets).forEach(function(e){var i=t.assets[e];switch(t.beforeAssetLoad(i),i.type){case"texture":t.loadTexture(e,i);break;case"mesh":t.loadMesh(e,i);break;default:throw new Error("invalid asset type")}})})}},{key:"loadTexture",value:function(t,e){var i=this,s=(new o.A).load(e.path,function(){i.textures[t]=s,i.onAssetLoaded(e)})}},{key:"loadMesh",value:function(t,e){var i=this;(new h.a).load(e.materialPath,function(s){s.preload(),(new l.a).setMaterials(s).load(e.path,function(s){i.meshes[t]=s,i.onAssetLoaded(e)})})}},{key:"beforeAssetLoad",value:function(t){t.timeToLoad=new Date}},{key:"onAssetLoaded",value:function(t){t.timeToLoad=new Date-t.timeToLoad,this.assetsLoaded++,this.assetsLoaded===this.assetCount&&(this.resolve(),this.resolve=null)}}]),t}(),d=function(){function t(){Object(s.a)(this,t),this.domElement=null,this.logItems=[],this.bounds={}}return Object(n.a)(t,[{key:"init",value:function(){this.domElement=document.createElement("div"),this.domElement.style.color="#fff",this.domElement.style.fontFamily="Arial, Helvetica, sans-serif",this.domElement.style.fontSize="22px",this.domElement.style.position="absolute",this.domElement.style.left="10px",this.domElement.style.top="10px",this.domElement.style.zIndex=100,document.body.appendChild(this.domElement)}},{key:"update",value:function(){this.domElement.innerHTML=this.logItems.join("<br/>"),this.logItems.length=0}},{key:"log",value:function(t){this.logItems.push(t)}},{key:"logNumber",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.logItems.push("".concat(t,": ").concat(e.toFixed(i)))}},{key:"logVector3",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.logItems.push("".concat(t,": ").concat(e.x.toFixed(i)," ").concat(e.y.toFixed(i)," ").concat(e.z.toFixed(i)))}},{key:"logBounds",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.bounds[t]||(this.bounds[t]={min:1/0,max:-1/0});var s=this.bounds[t];s.min=Math.min(e,s.min),s.max=Math.max(e,s.max),this.logItems.push("".concat(t,": ").concat(e.toFixed(i)," (min: ").concat(s.min.toFixed(i),", max: ").concat(s.max.toFixed(i),")"))}}]),t}(),u=function(){function t(){Object(s.a)(this,t)}return Object(n.a)(t,[{key:"init",value:function(){this.domElement=document.createElement("div"),this.domElement.style.color="#fff",this.domElement.style.fontFamily="Arial, Helvetica, sans-serif",this.domElement.style.fontSize="16px",this.domElement.style.textAlign="right",this.domElement.style.position="absolute",this.domElement.style.right="10px",this.domElement.style.bottom="20px",this.domElement.style.zIndex=100,this.domElement.style.opacity=.4,this.domElement.innerHTML='\n\t\t\t<h2 style="margin-bottom: 5px">Flight</h2>\n\t\t\t<div>Sergiu-Valentin Bucur, 2019<div>\n\t\t',document.body.appendChild(this.domElement)}}]),t}(),m={WorldSize:128,WorldUnit:1,WorldMaxHeight:16,DrawDistance:128},p=new o.C(-1.33,-.46,1.2),f=new o.C(1.77,.78,-1.45),g=m.WorldSize/2,y=m.DrawDistance/2,v=m.DrawDistance,k=function(){function t(e,i){Object(s.a)(this,t),this.flatShading=!0,this.assetLibrary=null,this.scene=null,this.dirLight1=null,this.dirLight2=null,this.heightmap=null,this.lightRotation=0,this.assetLibrary=e,this.logger=i}return Object(n.a)(t,[{key:"init",value:function(){var t=a.a.parse(window.location.search);this.flatShading="1"===(t.flat||"1"),this.initHeightmap(),this.scene=new o.z,this.scene.background=new o.b(1258321),this.scene.fog=new o.i(1258321,y,v),this.dirLight1=new o.d(16773344),this.dirLight1.position.copy(p).normalize(),this.scene.add(this.dirLight1),this.dirLight2=new o.d(1258321),this.dirLight2.position.copy(f).normalize(),this.scene.add(this.dirLight2);for(var e=this.getGroundMesh(),i=-2;i<3;i++)for(var s=-2;s<3;s++){var n=e.clone();n.position.set(i*m.WorldSize,0,s*m.WorldSize),this.scene.add(n)}}},{key:"update",value:function(){this.lightRotation+=.0025;var t=new o.e(0,this.lightRotation,0,"XYZ");this.dirLight1.position.copy(p).normalize().applyEuler(t),this.dirLight2.position.copy(f).normalize().applyEuler(t)}},{key:"getGroundMesh",value:function(){var t=new o.k;t.faceVertexUvs=[[]];for(var e=0,i=0;i<m.WorldSize;i++)for(var s=0;s<m.WorldSize;s++){var n=this.getHeight(i,s),r=this.getHeight(i+1,s),a=this.getHeight(i,s+1),h=this.getHeight(i+1,s+1),l=m.WorldUnit*i-g,c=-m.WorldUnit*s+g,d=m.WorldUnit*(i+1)-g,u=-m.WorldUnit*(s+1)+g;t.vertices.push(new o.C(l,n,c)),t.vertices.push(new o.C(d,r,c)),t.vertices.push(new o.C(l,a,u)),t.faces.push(new o.f(e,e+1,e+2)),t.faceVertexUvs[0].push([new o.B(0,0),new o.B(1,0),new o.B(0,1)]),t.vertices.push(new o.C(d,r,c)),t.vertices.push(new o.C(d,h,u)),t.vertices.push(new o.C(l,a,u)),t.faces.push(new o.f(e+3,e+4,e+5)),t.faceVertexUvs[0].push([new o.B(1,0),new o.B(1,1),new o.B(0,1)]),e+=6}this.flatShading||t.mergeVertices(),t.computeVertexNormals();var p=(new o.a).fromGeometry(t),f=new o.t;return f.color=new o.b(15583663),new o.s(p,f)}},{key:"initHeightmap",value:function(){var t=document.createElement("canvas").getContext("2d");t.drawImage(this.assetLibrary.textures.heightmap.image,0,0);for(var e=m.WorldSize+1,i=t.getImageData(0,0,e,e).data,s=[],n=0;n<e;n++){for(var o=[],r=0;r<e;r++)o.push(i[4*(r+n*e)]/255*m.WorldMaxHeight);s.push(o)}this.heightmap=s}},{key:"getHeight",value:function(t,e){return t===m.WorldSize&&(t=0),e===m.WorldSize&&(e=0),this.heightmap[m.WorldSize-e][t]}},{key:"getInterpolatedHeight",value:function(t){var e=t.x+g,i=t.z+g,s=Math.floor(e),n=Math.floor(i),o=this.heightmap[n][s],r=this.heightmap[n][s+1],a=this.heightmap[n+1][s+1],h=e-s,l=i-n;return(1-l)*((1-h)*o+h*r)+l*((1-h)*this.heightmap[n+1][s]+h*a)}},{key:"clipCoordinates",value:function(t){t.x=this.clipCoordinate(t.x),t.z=this.clipCoordinate(t.z)}},{key:"clipCoordinate",value:function(t){if(t<-g){var e=Math.abs(-g-t);return g-e}if(t>=g){var i=Math.abs(g-t);return-g+i}return t}}]),t}(),w=function(){function t(e){Object(s.a)(this,t),this.logger=null,this.keysPressed={},this.ctrl=!1,this.alt=!1,this.shift=!1,this.movementX=0,this.movementY=0,this.usePointerLock=!1,this.logger=e}return Object(n.a)(t,[{key:"init",value:function(){var t=this;document.addEventListener("contextmenu",function(t){t.preventDefault()}),document.addEventListener("keydown",function(e){t.keysPressed[e.keyCode]=!0,t.ctrl=e.ctrlKey,t.alt=e.altKey,t.shift=e.shiftKey}),document.addEventListener("keyup",function(e){t.keysPressed[e.keyCode]=!1,t.ctrl=e.ctrlKey,t.alt=e.altKey,t.shift=e.shiftKey}),this.usePointerLock&&(document.addEventListener("mousedown",function(t){2===t.button&&null===document.pointerLockElement&&document.body.requestPointerLock()}),document.addEventListener("mousemove",function(e){null!==document.pointerLockElement&&(t.movementX=e.movementX,t.movementY=e.movementY)}))}},{key:"resetMovement",value:function(){this.movementX=0,this.movementY=0}},{key:"update",value:function(){this.usePointerLock&&null===document.pointerLockElement&&this.logger.log("right-click for pointer lock"),this.resetMovement()}}]),t}(),b=87,x=83,C=65,L=68,E=38,T=40,P=37,R=39,S=32,O=52,M=function(){function t(e,i,n,r){Object(s.a)(this,t),this.camera=null,this.inputTracker=null,this.logger=null,this.world=null,this.position=new o.C(0,m.WorldMaxHeight+1,0),this.forward=new o.C(0,0,-1),this.right=new o.C(1,0,0),this.rotationX=0,this.rotationY=0,this.speed=.25,this.horizontalSensitivity=.125,this.verticalSensitivity=.125,this.camera=e,this.inputTracker=i,this.logger=n,this.world=r}return Object(n.a)(t,[{key:"init",value:function(){this.camera.position.copy(this.position)}},{key:"update",value:function(){this.updateRotation();var t=this.getVelocity(),e=this.position.clone().add(t);this.updatePosition(e)}},{key:"getVelocity",value:function(){var t=new o.C;return this.inputTracker.keysPressed[b]&&t.add(this.forward),this.inputTracker.keysPressed[x]&&t.sub(this.forward),this.inputTracker.keysPressed[C]&&t.sub(this.right),this.inputTracker.keysPressed[L]&&t.add(this.right),t.multiplyScalar(this.speed),t}},{key:"updateRotation",value:function(){this.rotationX-=this.inputTracker.movementY*this.verticalSensitivity,this.rotationX=o.r.clamp(this.rotationX,-80,80),this.rotationY-=this.inputTracker.movementX*this.horizontalSensitivity;var t=new o.e(o.r.degToRad(this.rotationX),o.r.degToRad(this.rotationY),0,"ZYX");this.forward.set(0,0,-1),this.forward.applyEuler(t),t.set(0,o.r.degToRad(this.rotationY),0,"ZYX"),this.right.set(1,0,0),this.right.applyEuler(t),this.camera.lookAt(this.position.clone().add(this.forward))}},{key:"updatePosition",value:function(t){this.world.clipCoordinates(t);var e=this.world.getInterpolatedHeight(t)+.5;t.y=o.r.clamp(t.y,e,1/0),this.position.copy(t),this.camera.position.copy(this.position)}}]),t}(),X=new o.C(0,2.5,5),z=function(){function t(e,i,n,r,a){Object(s.a)(this,t),this.camera=null,this.inputTracker=null,this.logger=null,this.world=null,this.mesh=null,this.glowMaterial=null,this.position=new o.C(0,0,0),this.velocity=0,this.acceleration=0,this.rotationX=0,this.rotationY=0,this.meshRotationXOffset=0,this.meshRotationZOffset=0,this.camera=e,this.inputTracker=i,this.logger=n,this.world=r,this.assetLibrary=a}return Object(n.a)(t,[{key:"init",value:function(){this.mesh=this.getMesh(),this.glowMaterial=this.mesh.children[0].material[4],this.reset()}},{key:"reset",value:function(){this.velocity=.05,this.acceleration=0,this.turboMode=!1,this.rotationX=0,this.rotationY=0,this.meshRotationXOffset=0,this.meshRotationZOffset=0,this.updatePosition(new o.C(0,m.WorldMaxHeight+1,0))}},{key:"getMesh",value:function(){var t=this.assetLibrary.meshes.spaceship.clone();return t.scale.set(.1,.1,.1),t}},{key:"updateCameraPosition",value:function(){var t=new o.e(o.r.degToRad(this.rotationX),o.r.degToRad(this.rotationY),0,"ZYX"),e=X.clone().applyEuler(t);this.camera.position.copy(this.position).add(e),this.camera.lookAt(this.position)}},{key:"update",value:function(){this.updateRotation();var t=new o.e(o.r.degToRad(this.rotationX),o.r.degToRad(this.rotationY),0,"ZYX");this.inputTracker.keysPressed[b]&&(this.acceleration+=.005,this.inputTracker.keysPressed[S]&&(this.acceleration+=.025)),this.velocity+=this.acceleration,this.velocity*=.99,this.velocity=o.r.clamp(this.velocity,.05,1/0),this.acceleration*=.1;var e=new o.C(0,0,-this.velocity).applyEuler(t),i=this.position.clone().add(e);this.updatePosition(i),this.logger.log("".concat((5400*this.velocity).toFixed(0)," km/h"))}},{key:"updateRotation",value:function(){var t=o.r.clamp(2*this.velocity,0,1.1);this.inputTracker.keysPressed[E]&&(this.rotationX-=.5*t,this.meshRotationXOffset-=.1),this.inputTracker.keysPressed[T]&&(this.rotationX+=.5*t,this.meshRotationXOffset+=.1),this.inputTracker.keysPressed[P]&&(this.rotationY+=t,this.meshRotationZOffset+=.1),this.inputTracker.keysPressed[R]&&(this.rotationY-=t,this.meshRotationZOffset-=.1),this.rotationX=o.r.clamp(this.rotationX,-30,30),this.meshRotationXOffset*=.99,this.meshRotationZOffset*=.99,this.meshRotationXOffset=o.r.clamp(this.meshRotationXOffset,-15,15),this.meshRotationZOffset=o.r.clamp(this.meshRotationZOffset,-15,15)}},{key:"updatePosition",value:function(t){this.world.clipCoordinates(t);var e=this.world.getInterpolatedHeight(t);if(t.y<=e)this.reset();else{this.position.copy(t),this.mesh.position.copy(this.position),this.mesh.rotation.set(o.r.degToRad(this.rotationX+this.meshRotationXOffset),o.r.degToRad(this.rotationY),o.r.degToRad(2*this.meshRotationZOffset),"YXZ");var i=o.r.clamp(this.velocity/.55,.25,1);this.glowMaterial.emissive.setRGB(i,i,i),this.updateCameraPosition()}}}]),t}(),W=function(){function t(){Object(s.a)(this,t),this.firstPersonControlsMode=!1,this.halfSizeRendering=!0,this.assetLibrary=null,this.logger=null,this.inputTracker=null,this.camera=null,this.firstPersonControls=null,this.world=null,this.renderer=null,this.creditsBox=null}return Object(n.a)(t,[{key:"init",value:function(){var t=this,e=a.a.parse(window.location.search);this.firstPersonControlsMode="1"===(e.fps||0),this.halfSizeRendering="1"===(e.halfSize||"1"),this.assetLibrary=new c,this.assetLibrary.init().then(function(){t.initLogger(),t.initCreditsBox(),t.initInputTracker(),t.initCamera(),t.initWorld(),t.firstPersonControlsMode?t.initFirstPersonControls():t.initSpaceship(),t.initRenderer(),t.removeLoadingBar(),t.run()})}},{key:"initLogger",value:function(){this.logger=new d,this.logger.init()}},{key:"initCreditsBox",value:function(){this.creditsBox=new u,this.creditsBox.init()}},{key:"initInputTracker",value:function(){this.inputTracker=new w(this.logger),this.inputTracker.usePointerLock=this.firstPersonControlsMode,this.inputTracker.init()}},{key:"initCamera",value:function(){this.camera=new o.v(70,window.innerWidth/window.innerHeight,.01,m.DrawDistance)}},{key:"initFirstPersonControls",value:function(){this.firstPersonControls=new M(this.camera,this.inputTracker,this.logger,this.world),this.firstPersonControls.init()}},{key:"initWorld",value:function(){this.world=new k(this.assetLibrary,this.logger),this.world.init()}},{key:"initSpaceship",value:function(){this.spaceship=new z(this.camera,this.inputTracker,this.logger,this.world,this.assetLibrary),this.spaceship.init(),this.world.scene.add(this.spaceship.mesh)}},{key:"initRenderer",value:function(){var t=window.innerWidth,e=window.innerHeight;this.halfSizeRendering&&(t/=2,e/=2),this.renderer=new o.E({antialias:!0}),this.renderer.setSize(t,e),document.body.appendChild(this.renderer.domElement),this.halfSizeRendering&&(this.renderer.domElement.style.width=2*t+"px",this.renderer.domElement.style.height=2*e+"px")}},{key:"removeLoadingBar",value:function(){var t=document.querySelector("body > .loading");document.body.removeChild(t)}},{key:"run",value:function(){var t=this;requestAnimationFrame(function(){return t.run()}),this.update(),this.draw()}},{key:"update",value:function(){this.logger.update(),this.firstPersonControlsMode||(this.logger.log("\u2190\u2191\u2193\u2192 - Steering"),this.logger.log("W - Acceleration"),this.logger.log("Space - Turbo Mode"),this.logger.log(),this.logger.log("Alt + Shift + 4 - First Person Mode"),this.logger.log()),this.world.update(),this.firstPersonControlsMode?this.firstPersonControls.update():this.spaceship.update(),this.checkForSpecialKeyCombination(),this.inputTracker.update()}},{key:"draw",value:function(){this.renderer.render(this.world.scene,this.camera)}},{key:"checkForSpecialKeyCombination",value:function(){this.inputTracker.alt&&this.inputTracker.shift&&this.inputTracker.keysPressed[O]&&(window.location.href="?fps=1&halfSize=0&flat=0")}}]),t}();i(18);(new W).init()},6:function(t,e,i){t.exports=i(19)}},[[6,1,2]]]);